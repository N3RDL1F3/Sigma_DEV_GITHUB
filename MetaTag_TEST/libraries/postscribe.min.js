!function(){function j(z,y){z=z||"",y=y||{};for(var x in i){i.hasOwnProperty(x)&&(y.autoFix&&(y["fix_"+x]=!0),y.fix=y.fix||y["fix_"+x])}var w=[],v=document.createElement("div"),u=function(h){return"string"==typeof h&&h.indexOf("&")!==-1?(v.innerHTML=h,v.textContent||v.innerText||h):h},g=function(a){z+=a},f=function(a){z=a+z},e={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},d={comment:function(){var a=z.indexOf("-->");if(a>=0){return{content:z.substr(4,a),length:a+3}}},endTag:function(){var a=z.match(o);if(a){return{tagName:a[1],length:a[0].length}}},atomicTag:function(){var a=d.startTag();if(a){var q=z.slice(a.length);if(q.match(new RegExp("</\\s*"+a.tagName+"\\s*>","i"))){var h=q.match(new RegExp("([\\s\\S]*?)</\\s*"+a.tagName+"\\s*>","i"));if(h){return{tagName:a.tagName,attrs:a.attrs,content:h[1],length:h[0].length+a.length}}}}},startTag:function(){var a=z.indexOf(">");if(a===-1){return null}var t=z.match(p);if(t){var s={},r={},q=t[2];return t[2].replace(n,function(C,h){if(arguments[2]||arguments[3]||arguments[4]||arguments[5]){if(arguments[5]){s[arguments[5]]="",r[h]=!0}else{var D=arguments[2]||arguments[3]||arguments[4]||m.test(h)&&h||"";s[h]=u(D)}}else{s[h]=null}q=q.replace(C,"")}),{tagName:t[1],attrs:s,booleanAttrs:r,rest:q,unary:!!t[3],length:t[0].length}}},chars:function(){var a=z.indexOf("<");return{length:a>=0?a:z.length}}},c=function(){for(var a in e){if(e[a].test(z)){l&&console.log("suspected "+a);var h=d[a]();return h?(l&&console.log("parsed "+a,h),h.type=h.type||a,h.text=z.substr(0,h.length),z=z.slice(h.length),h):null}}},b=function(q){for(var h;h=c();){if(q[h.type]&&q[h.type](h)===!1){return}}},B=function(){var a=z;return z="",a},A=function(){return z};return y.fix&&!function(){var F=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,E=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i,D=[];D.last=function(){return this[this.length-1]},D.lastTagNameEq=function(H){var G=this.last();return G&&G.tagName&&G.tagName.toUpperCase()===H.toUpperCase()},D.containsTagName=function(H){for(var G,I=0;G=this[I];I++){if(G.tagName===H){return !0}}return !1};var C=function(G){return G&&"startTag"===G.type&&(G.unary=F.test(G.tagName)||G.unary,G.html5Unary=!/\/>$/.test(G.text)),G},t=c,s=function(){var G=z,H=C(t());return z=G,H},r=function(){var G=D.pop();f("</"+G.tagName+">")},q={startTag:function(H){var G=H.tagName;"TR"===G.toUpperCase()&&D.lastTagNameEq("TABLE")?(f("<TBODY>"),a()):y.fix_selfClose&&E.test(G)&&D.containsTagName(G)?D.lastTagNameEq(G)?r():(f("</"+H.tagName+">"),a()):H.unary||D.push(H)},endTag:function(H){var G=D.last();G?y.fix_tagSoup&&!D.lastTagNameEq(H.tagName)?r():D.pop():y.fix_tagSoup&&h()}},h=function(){t(),a()},a=function(){var G=s();G&&q[G.type]&&q[G.type](G)};c=function(){return a(),C(t())}}(),{append:g,readToken:c,readTokens:b,clear:B,rest:A,stack:w}}var i=function(){var e,d={},f=this.document.createElement("div");return e="<P><I></P></I>",f.innerHTML=e,d.tagSoup=f.innerHTML!==e,f.innerHTML="<P><i><P></P></i></P>",d.selfClose=2===f.childNodes.length,d}(),p=/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,o=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,n=/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,m=/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i,l=!1;j.supports=i,j.tokenToString=function(d){var c={comment:function(b){return"<!--"+b.content},endTag:function(b){return"</"+b.tagName+">"},atomicTag:function(b){return l&&console.log(b),c.startTag(b)+b.content+c.endTag(b)},startTag:function(f){var e="<"+f.tagName;for(var h in f.attrs){e+=" "+h;var g=f.attrs[h];"undefined"!=typeof f.booleanAttrs&&"undefined"!=typeof f.booleanAttrs[h]||(e+='="'+(g?g.replace(/(^|[^\\])"/g,'$1\\"'):"")+'"')}return f.rest&&(e+=f.rest),e+(f.unary&&!f.html5Unary?"/>":">")},chars:function(b){return b.text}};return c[d.type](d)},j.escapeAttributes=function(f){var e={};for(var h in f){var g=f[h];e[h]=g&&g.replace(/(^|[^\\])"/g,'$1\\"')}return e};for(var k in i){j.browserHasFlaw=j.browserHasFlaw||!i[k]&&k}this.htmlParser=j}(),function(){function H(){}function G(b){return b!==v&&null!==b}function F(b){return"function"==typeof b}function E(g,f,j){var i,h=g&&g.length||0;for(i=0;i<h;i++){f.call(j,g[i],i)}}function D(f,e,h){var g;for(g in f){f.hasOwnProperty(g)&&e.call(h,g,f[g])}}function C(d,c){return D(c,function(a,e){d[a]=e}),d}function B(b,d){return b=b||{},D(d,function(e,a){G(b[e])||(b[e]=a)}),b}function A(e){try{return t.call(e)}catch(f){var d=[];return E(e,function(b){d.push(b)}),d}}function z(b){return !!(b&&"tagName" in b)&&!!~b.tagName.toLowerCase().indexOf("script")}function y(b){return !!(b&&"tagName" in b)&&!!~b.tagName.toLowerCase().indexOf("style")}var x={afterAsync:H,afterDequeue:H,afterStreamStart:H,afterWrite:H,autoFix:!0,beforeEnqueue:H,beforeWriteToken:function(b){return b},beforeWrite:function(b){return b},done:H,error:function(b){throw b},releaseAsync:!1},w=this.getSDG().getRes()[getSDG().getSetup().RESOURCES.POSTSCRIBE],v=void 0;if(!w.postscribe){var u=!1,t=Array.prototype.slice,s=function(b){return b[b.length-1]},r=function(){function b(g,k,j){var i=c+k;if(2===arguments.length){var h=g.getAttribute(i);return G(h)?String(h):h}G(j)&&""!==j?g.setAttribute(i,j):g.removeAttribute(i)}function d(a,f){var e=a.ownerDocument;C(this,{root:a,options:f,win:e.defaultView||e.parentWindow,doc:e,parser:htmlParser("",{autoFix:f.autoFix}),actuals:[a],proxyHistory:"",proxyRoot:e.createElement(a.nodeName),scriptStack:[],writeQueue:[]}),b(this.proxyRoot,"proxyof",0)}var c="data-ps-";return d.prototype.write=function(){[].push.apply(this.writeQueue,arguments);for(var e;!this.deferredRemote&&this.writeQueue.length;){e=this.writeQueue.shift(),F(e)?this.callFunction(e):this.writeImpl(e)}},d.prototype.callFunction=function(f){var e={type:"function",value:f.name||f.toString()};this.onScriptStart(e),f.call(this.win,this.doc),this.onScriptDone(e)},d.prototype.writeImpl=function(g){this.parser.append(g);for(var f,j,i,h=[];(f=this.parser.readToken())&&!(j=z(f))&&!(i=y(f));){f=this.options.beforeWriteToken(f),f&&h.push(f)}this.writeStaticTokens(h),j&&this.handleScriptToken(f),i&&this.handleStyleToken(f)},d.prototype.writeStaticTokens=function(f){var e=this.buildChunk(f);if(e.actual){return e.html=this.proxyHistory+e.actual,this.proxyHistory+=e.proxy,this.proxyRoot.innerHTML=e.html,u&&(e.proxyInnerHTML=this.proxyRoot.innerHTML),this.walkChunk(),u&&(e.actualInnerHTML=this.root.innerHTML),e}},d.prototype.buildChunk=function(h){var g=this.actuals.length,k=[],j=[],i=[];return E(h,function(e){var l=htmlParser.tokenToString(e);if(k.push(l),e.attrs){if(!/^noscript$/i.test(e.tagName)){var f=g++;j.push(l.replace(/(\/?>)/," "+c+"id="+f+" $1")),"ps-script"!==e.attrs.id&&"ps-style"!==e.attrs.id&&i.push("atomicTag"===e.type?"":"<"+e.tagName+" "+c+"proxyof="+f+(e.unary?" />":">"))}}else{j.push(l),i.push("endTag"===e.type?l:"")}}),{tokens:h,raw:k.join(""),actual:j.join(""),proxy:i.join("")}},d.prototype.walkChunk=function(){for(var k,j=[this.proxyRoot];G(k=j.shift());){var i=1===k.nodeType,h=i&&b(k,"proxyof");if(!h){i&&(this.actuals[b(k,"id")]=k,b(k,"id",null));var a=k.parentNode&&b(k.parentNode,"proxyof");a&&this.actuals[a].appendChild(k)}j.unshift.apply(j,A(k.childNodes))}},d.prototype.handleScriptToken=function(f){var e=this.parser.clear();if(e&&this.writeQueue.unshift(e),f.src=f.attrs.src||f.attrs.SRC,f=this.options.beforeWriteToken(f)){f.src&&this.scriptStack.length?this.deferredRemote=f:this.onScriptStart(f);var g=this;this.writeScriptToken(f,function(){g.onScriptDone(f)})}},d.prototype.handleStyleToken=function(f){var e=this.parser.clear();e&&this.writeQueue.unshift(e),f.type=f.attrs.type||f.attrs.TYPE||"text/css",f=this.options.beforeWriteToken(f),f&&this.writeStyleToken(f),e&&this.write()},d.prototype.writeStyleToken=function(f){var e=this.buildStyle(f);this.insertStyle(e),f.content&&(e.styleSheet&&!e.sheet?e.styleSheet.cssText=f.content:e.appendChild(this.doc.createTextNode(f.content)))},d.prototype.buildStyle=function(f){var e=this.doc.createElement(f.tagName);return e.setAttribute("type",f.type),D(f.attrs,function(g,h){e.setAttribute(g,h)}),e},d.prototype.insertStyle=function(f){this.writeImpl('<span id="ps-style"/>');var e=this.doc.getElementById("ps-style");e.parentNode.replaceChild(f,e)},d.prototype.onScriptStart=function(e){e.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(e)},d.prototype.onScriptDone=function(e){return e!==this.scriptStack[0]?void this.options.error({message:"Bad script nesting or script finished twice"}):(this.scriptStack.shift(),this.write.apply(this,e.outerWrites),void (!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=null)))},d.prototype.writeScriptToken=function(g,f){var j=this.buildScript(g),i=this.shouldRelease(j),h=this.options.afterAsync;g.src&&(j.src=g.src,this.scriptLoadHandler(j,i?h:function(){f(),h()}));try{this.insertScript(j),g.src&&!i||f()}catch(g){this.options.error(g),f()}},d.prototype.buildScript=function(f){var e=this.doc.createElement(f.tagName);return D(f.attrs,function(g,h){e.setAttribute(g,h)}),f.content&&(e.text=f.content),e},d.prototype.insertScript=function(f){this.writeImpl('<span id="ps-script"/>');var e=this.doc.getElementById("ps-script");e.parentNode.replaceChild(f,e)},d.prototype.scriptLoadHandler=function(h,f){function l(){h=h.onload=h.onreadystatechange=h.onerror=null}function k(){l(),f()}function j(e){l(),i(e),f()}var i=this.options.error;C(h,{onload:function(){k()},onreadystatechange:function(){/^(loaded|complete)$/.test(h.readyState)&&k()},onerror:function(){j({message:"remote script failed "+h.src})}})},d.prototype.shouldRelease=function(f){var e=/^script$/i.test(f.nodeName);return !e||!!(this.options.releaseAsync&&f.src&&f.hasAttribute("async"))},d}();w.postscribe=function(){function c(){var e,d=f.shift();d&&(e=s(d),e.afterDequeue(),d.stream=k.apply(null,d),e.afterStreamStart())}function k(q,o,m){function i(d){d=m.beforeWrite(d),a.write(d),m.afterWrite(d)}a=new r(q,m),a.id=g++,a.name=m.name||a.id,h.streams[a.name]=a;var e=q.ownerDocument,b={close:e.close,open:e.open,write:e.write,writeln:e.writeln};C(e,{close:H,open:H,write:function(){return i(A(arguments).join(""))},writeln:function(){return i(A(arguments).join("")+"\n")}});var p=a.win.onerror||H;return a.win.onerror=function(j,d,l){m.error({msg:j+" - "+d+":"+l}),p.apply(a.win,arguments)},a.write(o,function(){C(e,b),a.win.onerror=p,m.done(),a=null,c()}),a}function h(l,j,i){F(i)&&(i={done:i}),i=B(i,x),l=/^#/.test(l)?w.document.getElementById(l.substr(1)):l.jquery?l[0]:l;var b=[l,j,i];return l.postscribe={cancel:function(){b.stream?b.stream.abort():b[1]=H}},i.beforeEnqueue(b),f.push(b),a||c(),l.postscribe}var g=0,f=[],a=null;return C(h,{streams:{},queue:f,WriteStream:r})}()}}();